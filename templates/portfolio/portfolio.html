{% extends 'main.html' %}{% load cmt_helper %}
{%load static%}
{% block title %}
<div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
    <div class="page-title d-flex flex-column gap-1 me-3 mb-2">
        <ul class="breadcrumb breadcrumb-separatorless fw-semibold mb-6">
            <li class="breadcrumb-item text-gray-700 fw-bold lh-1">
                <a href="" class="text-gray-500 text-hover-primary">
                    <i class="ki-duotone ki-home fs-3 text-gray-400 me-n1"></i>
                </a>
            </li>
            <li class="breadcrumb-item">
                <i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i>
            </li>
            <li class="breadcrumb-item text-gray-700 fw-bold lh-1">Dashboards</li>
            <li class="breadcrumb-item">
                <i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i>
            </li>
            <li class="breadcrumb-item text-gray-700">Portfolio</li>
        </ul>
        <h1 class="page-heading d-flex flex-column justify-content-center text-dark fw-bolder fs-1 lh-0">Portfolio</h1>
    </div>
    <a  id="portfolio_drawer" class="btn btn-sm btn-outline  btn-light-primary"><span class="grey-blue loadUploadComponent"><span class="font-small-1"> <i class="fa ft-upload-cloud font-medium-1"></i> Load Kickstart /Offcycle  File</span>  </button>  </span></a>
</div>
{% endblock %}
{% block content %}
<div class="card">
    <div class="row match-height mb-2">
        <div class='col-3'>
            <div class="card card-flush bgi-no-repeat bgi-size-contain bgi-position-x-center border-2 h-md-100 mb-5 mb-xl-10" >
                <div class="card-header pt-5">
                    <div class="card-title d-flex flex-column">
                        <span class="card-title">RFQ Section</span>
                    </div>
                    <div class="card-toolbar">
                        <button id='send_rfq_button_main' class="btn btn-light-info btn-sm float-end" type="button" onclick="send_rfq_bulk()"><i class="fas fs-8 fa-paper-plane"></i> Send RFQ</button>
                    </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0">
                    <div class="d-flex align-items-center flex-column mt-3 w-100">
                        <div class="d-flex justify-content-between fw-bold fs-6 text-white w-100 mt-auto mb-2">
                            <span>
                                <div class="media">
                                    <div class="card-body pt-2 pb-4 px-4">                 
                                        <div class="d-flex flex-stack">
                                            <div class="text-gray-700 fw-semibold fs-6 me-2">RFQ Raised</div>
                                            <div class="d-flex align-items-senter">
                                                <span class="badge badge-light-dark" style="min-width: 120px;">
                                                    <span class="svg-icon svg-icon-2 svg-icon-primary me-2">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M15.43 8.56949L10.744 15.1395C10.6422 15.282 10.5804 15.4492 10.5651 15.6236C10.5498 15.7981 10.5815 15.9734 10.657 16.1315L13.194 21.4425C13.2737 21.6097 13.3991 21.751 13.5557 21.8499C13.7123 21.9488 13.8938 22.0014 14.079 22.0015H14.117C14.3087 21.9941 14.4941 21.9307 14.6502 21.8191C14.8062 21.7075 14.9261 21.5526 14.995 21.3735L21.933 3.33649C22.0011 3.15918 22.0164 2.96594 21.977 2.78013C21.9376 2.59432 21.8452 2.4239 21.711 2.28949L15.43 8.56949Z" fill="currentColor"/>
                                                            <path opacity="0.3" d="M20.664 2.06648L2.62602 9.00148C2.44768 9.07085 2.29348 9.19082 2.1824 9.34663C2.07131 9.50244 2.00818 9.68731 2.00074 9.87853C1.99331 10.0697 2.04189 10.259 2.14054 10.4229C2.23919 10.5869 2.38359 10.7185 2.55601 10.8015L7.86601 13.3365C8.02383 13.4126 8.19925 13.4448 8.37382 13.4297C8.54839 13.4145 8.71565 13.3526 8.85801 13.2505L15.43 8.56548L21.711 2.28448C21.5762 2.15096 21.4055 2.05932 21.2198 2.02064C21.034 1.98196 20.8409 1.99788 20.664 2.06648Z" fill="currentColor"/>
                                                        </svg>
                                                    </span>
                                                    <span class="text-gray-900 fw-bolder fs-6">{{RFQ_data.3}}</span> 
                                                </span>
                                                
                                            </div>   
                                        </div>
                                        <div class="separator separator-dashed my-3"></div>
                                        <div class="d-flex flex-stack">
                                            <div class="text-gray-700 fw-semibold fs-6 me-2">APN COUNT: Total</div>     
                                            <div class="d-flex align-items-senter">
                                                <span class="badge badge-light-dark" style="min-width: 120px;">
                                                    <span class="svg-icon svg-icon-2 svg-icon-primary me-2">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
                                                            <path d="M10.0813 3.7242C10.8849 2.16438 13.1151 2.16438 13.9187 3.7242V3.7242C14.4016 4.66147 15.4909 5.1127 16.4951 4.79139V4.79139C18.1663 4.25668 19.7433 5.83365 19.2086 7.50485V7.50485C18.8873 8.50905 19.3385 9.59842 20.2758 10.0813V10.0813C21.8356 10.8849 21.8356 13.1151 20.2758 13.9187V13.9187C19.3385 14.4016 18.8873 15.491 19.2086 16.4951V16.4951C19.7433 18.1663 18.1663 19.7433 16.4951 19.2086V19.2086C15.491 18.8873 14.4016 19.3385 13.9187 20.2758V20.2758C13.1151 21.8356 10.8849 21.8356 10.0813 20.2758V20.2758C9.59842 19.3385 8.50905 18.8873 7.50485 19.2086V19.2086C5.83365 19.7433 4.25668 18.1663 4.79139 16.4951V16.4951C5.1127 15.491 4.66147 14.4016 3.7242 13.9187V13.9187C2.16438 13.1151 2.16438 10.8849 3.7242 10.0813V10.0813C4.66147 9.59842 5.1127 8.50905 4.79139 7.50485V7.50485C4.25668 5.83365 5.83365 4.25668 7.50485 4.79139V4.79139C8.50905 5.1127 9.59842 4.66147 10.0813 3.7242V3.7242Z" fill="currentColor"/>
                                                            <path d="M14.8563 9.1903C15.0606 8.94984 15.3771 8.9385 15.6175 9.14289C15.858 9.34728 15.8229 9.66433 15.6185 9.9048L11.863 14.6558C11.6554 14.9001 11.2876 14.9258 11.048 14.7128L8.47656 12.4271C8.24068 12.2174 8.21944 11.8563 8.42911 11.6204C8.63877 11.3845 8.99996 11.3633 9.23583 11.5729L11.3706 13.4705L14.8563 9.1903Z" fill="white"/>
                                                        </svg>
                                                    </span>
                                                    <span class="text-gray-900 fw-bolder fs-6">{{RFQ_data.5}}</span> 
                                                </span>
                                            </div>         
                                        </div>
                                        <div class="separator separator-dashed my-3"></div>
                                        <div class="d-flex flex-stack">
                                            <div class="text-gray-700 fw-semibold fs-6 me-2">APN COUNT: Sent</div>
                                            <div class="d-flex align-items-senter">
                                                <span class="badge badge-light-dark" style="min-width: 120px;">
                                                    <span class="svg-icon svg-icon-2 svg-icon-primary me-2">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path opacity="0.3" d="M21 13H15V11H21C21.6 11 22 10.6 22 10C22 9.4 21.6 9 21 9H15V3C15 2.4 14.6 2 14 2C13.4 2 13 2.4 13 3V9H11V3C11 2.4 10.6 2 10 2C9.4 2 9 2.4 9 3V9H3C2.4 9 2 9.4 2 10C2 10.6 2.4 11 3 11H9V13H3C2.4 13 2 13.4 2 14C2 14.6 2.4 15 3 15H9V21C9 21.6 9.4 22 10 22C10.6 22 11 21.6 11 21V15H13V21C13 21.6 13.4 22 14 22C14.6 22 15 21.6 15 21V15H21C21.6 15 22 14.6 22 14C22 13.4 21.6 13 21 13Z" fill="currentColor"/>
                                                            <path d="M16 17H8C7.4 17 7 16.6 7 16V8C7 7.4 7.4 7 8 7H16C16.6 7 17 7.4 17 8V16C17 16.6 16.6 17 16 17ZM14 10H10V14H14V10Z" fill="currentColor"/>
                                                        </svg>
                                                    </span>          
                                                    <span class="text-gray-900 fw-bolder fs-6">{{RFQ_data.6}}</span> 
                                                </span>
                                            </div>      
                                        </div>
                                        <div class="separator separator-dashed my-3"></div>
                                        <div class="d-flex flex-stack">
                                            <div class="text-gray-700 fw-semibold fs-6 me-2">Total MPN in Portfolio  <span class="muted font-small-1">(Global + Regional)</span> </div>
                                            <div class="d-flex align-items-senter">
                                                <span class="badge badge-light-dark" style="min-width: 120px;">
                                                    <span class="svg-icon svg-icon-2 svg-icon-primary me-2">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path opacity="0.3" d="M21 13H15V11H21C21.6 11 22 10.6 22 10C22 9.4 21.6 9 21 9H15V3C15 2.4 14.6 2 14 2C13.4 2 13 2.4 13 3V9H11V3C11 2.4 10.6 2 10 2C9.4 2 9 2.4 9 3V9H3C2.4 9 2 9.4 2 10C2 10.6 2.4 11 3 11H9V13H3C2.4 13 2 13.4 2 14C2 14.6 2.4 15 3 15H9V21C9 21.6 9.4 22 10 22C10.6 22 11 21.6 11 21V15H13V21C13 21.6 13.4 22 14 22C14.6 22 15 21.6 15 21V15H21C21.6 15 22 14.6 22 14C22 13.4 21.6 13 21 13Z" fill="currentColor"/>
                                                            <path d="M16 17H8C7.4 17 7 16.6 7 16V8C7 7.4 7.4 7 8 7H16C16.6 7 17 7.4 17 8V16C17 16.6 16.6 17 16 17ZM14 10H10V14H14V10Z" fill="currentColor"/>
                                                        </svg>
                                                    </span>          
                                                    <span class="text-gray-900 fw-bolder fs-6">{{RFQ_data.2}}</span> 
                                                </span>
                                            </div>      
                                        </div>
                                    </div>
                                    </div>
                                    <div class="progress mt-1 mb-0" style="height: 7px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width:{{RFQ_data.4}}%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </span>    
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='col-3'>
            <div class="card card-flush bgi-no-repeat bgi-size-contain bgi-position-x-center border-2 mb-5 mb-xl-10" >
                <div class="card-header pt-5">
                    <div class="card-title d-flex flex-column">
                        <span class="card-title">Category</span>
                    </div>
                </div>
                <div class="d-flex m-3">
                    <div class="d-flex align-items-center flex-column w-100">
                        <div class="d-flex justify-content-between fw-bold fs-6 text-white w-100 mt-auto mb-2">
                            <button value="Global" class="table_regional_filter_tab btn btn-sm btn-light-info active font-small-1"> <i class="fa fa-globe"></i> Global</button>
                            <button  value="Regional" class="table_regional_filter_tab btn btn-sm btn-light-info font-small-1"> <i class="fa fa-map-pin"></i> Regional</button>
                        </div>
                        <div class="d-flex justify-content-between fw-bold fs-8 w-100 mt-auto mb-2">
                            <button value="all" class="table_filter_tab btn btn-sm btn-light-info active fs-8"> <i class="fa fa-group"></i> GSM</button>
                            <button  value="his_parts" class="table_filter_tab btn btn-sm btn-light-info fs-8"> <i class="fa fa-user"></i> My Portfolio</button>
                            <button  value="his_parts_offcycle" class="table_filter_tab btn btn-sm btn-light-info fs-8">  <i class="fa fa-database"></i> Non AVL Parts</button>
                        </div>

                        <div class="col-12 mb-2">
                            {% if request.user.is_superuser or request.user|has_group:"BP JPE Manager"  or request.user|has_group:"BP SGD Manager" or request.user|has_group:"BP HBG Manager"  %}
                            <button type="button" class="btn btn-float btn-square btn-light-info" data-toggle="modal" data-target="#offcycle_excel_import"><i class='fa fa-plus font-medium-1'></i> <span class="font-small-2">Add Parts for Non-AVL</span> </button>
                            {% endif %}
                        </div>

                        <div class="col-12 mb-2">
                            <button type="button" class="btn  btn-square btn-light-info width-300 mt-1" data-toggle="modal" data-target="#Pic_comment"><i class='ft-plus'></i>Add PIC Comment</button>
                        </div>
                    </div>    
                </div>
            </div>
        </div>
        <div class='col-3'>
            <div class="card card-flush bgi-no-repeat bgi-size-contain bgi-position-x-center border-2 mb-5 mb-xl-10">
                <div class="card-header pt-5">
                    <div class="card-title d-flex flex-column">
                        <span class="card-title">Data Export</span>
                    </div>
                </div>
                <div class="card-body d-flex align-items-end pt-0">
                    <!--begin::Progress-->
                    <div class="d-flex align-items-center flex-column  w-100">
                        <div class="d-flex m-3">
                            <div class="d-flex align-items-center flex-column w-100">
                                <div class="d-flex justify-content-between fw-bold fs-6 text-white w-100">
                                     <button type="button" class="btn btn-sm btn-outline btn-light-primary justify-content-end m-1" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">Export  <i class="fas fa-download"></i></button>
                                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-3" data-kt-menu="true">
                                        <div class="menu-item px-3"> <a  onclick="download_filtered_excel()"> <button type="button" class="btn btn-float btn-light-success mr-1 fs-8"><i class="fa fa-file-excel-o"></i><span class="font-small-1">Export Filtered parts </span></button></a></div>
                                        <div class="menu-item px-3"><a href="{%url 'download_portfolio' 'portfolio_SS'%}"> <button type="button" class="btn btn-float btn-light-success mt-1 fs-8"><i class="fa fa-file-excel-o"></i><span class="font-small-1">Export All</span></button> </a></div>
                                    </div>
                                    <button class="btn btn-square btn-sm btn-light-info fs-8 width-100 m-1" onclick="$('#Portfolio_table').DataTable().draw()"><i class="fa fa-refresh font-small-1"></i><span class="font-small-1"> Refresh</span></button>
                                    <button class="btn btn-square btn-sm btn-light-danger fs-8  width-100 m-1 float-left" onclick="window.location.reload()"> <i class="fa fa-remove font-small-1"></i><span class="font-small-1"> Clear Filters</span></button>
                                    </div>
                                <div class="d-flex justify-content-between fw-bold fs-8 w-100 mt-auto">
                                    {% if request.user.username == 'superadmin'%}
                                    <button type="button" class="btn btn-square btn-sm btn-success mt-1 fs-8  px-3" onclick="agile_refresh()"><span class="font-small-1">Agile Refresh</span></button>
                                    {%endif%}
                                </div>
                            </div>  
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='col-3'>
            <div class="card border-2">
                <div class="card-header">
                    <h3 class="card-title">Master Search</h3>
                    <div class="card-toolbar">
                        <button class="btn btn-sm btn-link px-2" type="button" data-bs-toggle="collapse" data-bs-target="#kt_accordion_1_body_1" aria-expanded="false" aria-controls="kt_accordion_1_body_1">
                            Advance Filter <i class="fas fa-circle-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body py-8 px-3">
                    <input class='form-control square pr-0 form-control-sm' type="text" id='Portfolio_master_search' placeholder="Master Search">
                </div>
                <div class="card-footer p-3">
                    <button class="btn btn-sm btn-outline btn-outline-info float-end"  id='Portfolio_master_search_button'><i class="fa fa-search"></i> Search</button>
                </div>
            </div>

        </div>
        <div class="accordion" id="kt_accordion_1">
            <div class="accordion-item">
                <div id="kt_accordion_1_body_1" class="accordion-collapse collapse" aria-labelledby="kt_accordion_1_header_1" data-bs-parent="#kt_accordion_1">
                    <div class="accordion-body">
                        <div class="row">
    
                            <div id='filter-data' class="row" style="width: 100%;">
                                <div class="col-md-2">
                                    <h5 class=" text-uppercase my-1"><i class="fas fa-eye"></i> Fields Visible
                                    </h5>
                                    <div id="mega-menu-carousel-example">
                                        <ul class="list-group" style="list-style-type: none; font-size: 12px;">
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Number">{{columns_name|dict_key:"Number"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="cm">Contract Manufacturer</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Ownership">{{columns_name|dict_key:"Ownership"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Arista_PIC">{{columns_name|dict_key:"Arista_PIC"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="commodity">Commodity</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Lifecycle_Phase">{{columns_name|dict_key:"Lifecycle_Phase"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Rev">{{columns_name|dict_key:"Rev"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Mfr_Name">{{columns_name|dict_key:"Mfr_Name"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Mfr_Part_Lifecycle_Phase">{{columns_name|dict_key:"Mfr_Part_Lifecycle_Phase"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Mfr_Part_Number">{{columns_name|dict_key:"Mfr_Part_Number"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Qualification_Status">{{columns_name|dict_key:"Qualification_Status"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="cm_Part_Number">{{columns_name|dict_key:"cm_Part_Number"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Arista_Part_Number">{{columns_name|dict_key:"Arista_Part_Number"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Cust_consign">{{columns_name|dict_key:"Cust_consign"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Parts_controlled_by">{{columns_name|dict_key:"Parts_controlled_by"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Item_Desc">{{columns_name|dict_key:"Item_Desc"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="LT">{{columns_name|dict_key:"LT"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="MOQ">{{columns_name|dict_key:"MOQ"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Quarter">{{columns_name|dict_key:"Quarter"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Original_PO_Delivery_sent_by_Mexico">{{columns_name|dict_key:"Original_PO_Delivery_sent_by_Mexico"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="cm_Quantity_Buffer_On_Hand">{{columns_name|dict_key:"cm_Quantity_Buffer_On_Hand"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="cm_Quantity_On_Hand_CS_Inv">{{columns_name|dict_key:"cm_Quantity_On_Hand_CS_Inv"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Open_PO_due_in_this_quarter">{{columns_name|dict_key:"Open_PO_due_in_this_quarter"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Open_PO_due_in_next_quarter">{{columns_name|dict_key:"Open_PO_due_in_next_quarter"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Delivery_Based_Total_OH_sum_OPO_this_quarter">{{columns_name|dict_key:"Delivery_Based_Total_OH_sum_OPO_this_quarter"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="PO_Based_Total_OH_sum_OPO">{{columns_name|dict_key:"PO_Based_Total_OH_sum_OPO"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="CQ_ARIS_FQ_sum_1_SANM_Demand">{{columns_name|dict_key:"CQ_ARIS_FQ_sum_1_SANM_Demand"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand">{{columns_name|dict_key:"CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="CQ_sum_3_ARIS_FQ_SANM_Demand">{{columns_name|dict_key:"CQ_sum_3_ARIS_FQ_SANM_Demand"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista">{{columns_name|dict_key:"Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista"}}</input>
                                            </li>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="sgd_jpe_cost">{{columns_name|dict_key:"sgd_jpe_cost"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1">{{columns_name|dict_key:"Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1"}}</input>
                                            </li>
                                            <li><input type="checkbox" class="toggle-vis" checked data-column="Blended_AVG_PO_Receipt_Price">{{columns_name|dict_key:"Blended_AVG_PO_Receipt_Price"}}</input>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                
                                <div class="col-md-5">
                                    <h5 class="dropdown-menu-header text-uppercase my-1"><i class="fas fa-file-excel"></i> Filter Excel</h5>
                                    <div id='reset_menu' hidden class="form-group row">
                                        <div class="col-sm-6 font ">
                                            <p>Reset to Upload new Excel</p>
                                        </div>
                                        <div class="col-sm-1 p-0  float-right">
                                        <button id='reset_button' class="btn btn-sm btn-danger">Reset</button>
                
                                        </div>
                                    </div>
                                    
                                    <form id='filterExcel' class="form form-horizontal" method="POST" enctype="multipart/form-data" action="">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-10">
                                                <input type="hidden" name="page" value="portfolio">
                                                <input type="file" required name='Upload_Excel'>
                                            </div>
                                            <div class="col-2">
                                                <button type="submit" class="btn btn-sm btn-outline btn-outline-success float-end">Submit</button>
                                            </div>
                                        </div>
                                    </form>
                                    <h6 class="card-title text-bold-700 m-0 "> <i class="fa fa-support"></i> INSTRUCTIONS</h6>
                                    <ol class="mt-0 pl-1" style="font-size: 12px;">
                                        <li>Click "Export filtered parts" or "Export all" to get the portfolio data into excel</li>
                                        <li>Delete the Rows / Part number which are not required in this screen.</li>
                                        <li>Make sure that there is no complete blank columns. If yes, then please delete the blank columns</li>
                                        <li>Make sure there are minimum two columns to apply the filter</li>
                                        <li>Save the excel</li>
                                        <li>Click choose file, select the saved excel and submit file to filter the data</li>
                                    </ol>
                                </div>
                
                         <div class="col-md-5">
                        <div class="border-left-grey border-left-lighten-3 ">
                            <div class="row">
                                <div class="col-12">
                                    <h5 class=" text-uppercase m-1"><i class="fa fa-filter"></i> Advance Filter
                                    <button type="button" class="btn btn-sm py-1 px-2 btn-outline-info btn-outline float-end" id="newrow"><i class="fa fa-plus"></i> New Parameter</button></h5>
                                       
                                </div>
                            <div class="col-12">
                                <form method="POST" id="advance_filter_portfolio_form">
                                    {%csrf_token%}
                                    <div id='Advance_filter_div' class="card-body py-0">
                                        <label for="filter_type">Filter type:</label>
                                        <select id='filter_type' class=" mb-4 border-0" name="type" >
                                            <option  selected value='and' >AND</option>
                                            <option   value='or' >OR</option>
                                        </select>
                                        <div class="row">
                
                                            <div class="col-md-12">
                                                <table class="table table-xs font-small-2 table-borderless" id="advance_filter_table">
                                                    <tbody>
                                                        <tr id="advance_filter_tr" style="display: none;">
                                                            <td class="pt-0">
                                                                <fieldset class="form-group">
                                                                    <select class="form-control fields" name="fields[]" onchange="getVal(this)" style="width: 100%;">
                                                                        <option disabled selected value='' >Select Field</option>
                                                                        <option value="Number">{{columns_name|dict_key:"Number"}}</option>
                                                                        <option value="Lifecycle_Phase">{{columns_name|dict_key:"Lifecycle_Phase"}}</option>
                                                                        <option value="Arista_Part_Number">{{columns_name|dict_key:"Arista_Part_Number"}}</option>
                                                                        <option value="Arista_PIC">{{columns_name|dict_key:"Arista_PIC"}}</option>
                                                                        <option value="Qualification_Status">{{columns_name|dict_key:"Qualification_Status"}}</option>
                                                                        <option value="Blended_AVG_PO_Receipt_Price">{{columns_name|dict_key:"Blended_AVG_PO_Receipt_Price"}}</option>
                                                                        <option value="cm_Part_Number">{{columns_name|dict_key:"cm_Part_Number"}}</option>
                                                                        <option value="cm_Quantity_Buffer_On_Hand">{{columns_name|dict_key:"cm_Quantity_Buffer_On_Hand"}}</option>
                                                                        <option value="cm_Quantity_On_Hand_CS_Inv">{{columns_name|dict_key:"cm_Quantity_On_Hand_CS_Inv"}}</option>
        
                                                                        <option value="commodity">Commodity</option>
                                                                        <option value="cm">Contract Manufacturer</option>
                                                                        <option value="Cust_consign">{{columns_name|dict_key:"Cust_consign"}}</option>
                                                                        <!-- <option value="ARIS_CQ_SANM_FQ_sum_1_unit_price_USD_Current_std">{{columns_name|dict_key:"ARIS_CQ_SANM_FQ_sum_1_unit_price_USD_Current_std"}}</option> --> 
                                                                        <option value="sgd_jpe_cost">{{columns_name|dict_key:"sgd_jpe_cost"}}</option>   
                                                                        <option value="CQ_ARIS_FQ_sum_1_SANM_Demand">{{columns_name|dict_key:"CQ_ARIS_FQ_sum_1_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD"}}</option>
                                                                        <option value="Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista">{{columns_name|dict_key:"Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista"}}</option>
                                                                        <option value="Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1">{{columns_name|dict_key:"Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1"}}</option>
                                                                        <option value="Item_Desc">{{columns_name|dict_key:"Item_Desc"}}</option>
                                                                        <option value="LT">{{columns_name|dict_key:"LT"}}</option>
        
                                                                        <option value="Mfr_Name">{{columns_name|dict_key:"Mfr_Name"}}</option>
                                                                        <option value="Mfr_Part_Lifecycle_Phase">{{columns_name|dict_key:"Mfr_Part_Lifecycle_Phase"}}</option>
                                                                        <option value="Mfr_Part_Number">{{columns_name|dict_key:"Mfr_Part_Number"}}</option>
                                                                        <option value="MOQ">{{columns_name|dict_key:"MOQ"}}</option>
        
                                                                        <option value="Open_PO_due_in_this_quarter">{{columns_name|dict_key:"Open_PO_due_in_this_quarter"}}</option>
                                                                        <option value="Open_PO_due_in_next_quarter">{{columns_name|dict_key:"Open_PO_due_in_next_quarter"}}</option>
                                                                        <option value="Ownership">{{columns_name|dict_key:"Ownership"}}</option>
        
        
                                                                        <option value="Parts_controlled_by">{{columns_name|dict_key:"Parts_controlled_by"}}</option>
                                                                        <option value="Original_PO_Delivery_sent_by_Mexico">{{columns_name|dict_key:"Original_PO_Delivery_sent_by_Mexico"}}</option>
        
        
                                                                        <option value="Quarter">{{columns_name|dict_key:"Quarter"}}</option>
                                                                        <option value="CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand">{{columns_name|dict_key:"CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_3_ARIS_FQ_SANM_Demand">{{columns_name|dict_key:"CQ_sum_3_ARIS_FQ_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand"}}</option>
        
                                                                        <option value="refreshed_comment">Refreshed Comment</option>
                                                                        <option value="refreshed_on">Refreshed on</option>
                                                                        <option value="Rev">{{columns_name|dict_key:"Rev"}}</option>
                                                                        <option value="rfq_sent_flag_supplier">RFQ Sent Status</option>
                                                                        <option value="Delivery_Based_Total_OH_sum_OPO_this_quarter">{{columns_name|dict_key:"Delivery_Based_Total_OH_sum_OPO_this_quarter"}}</option>
                                                                        <option value="PO_Based_Total_OH_sum_OPO">{{columns_name|dict_key:"PO_Based_Total_OH_sum_OPO"}}</option>
                                                        
                                                                    </select>
                                                                </fieldset>
                                                            </td>
                                                            <td class="pt-0">
                                                                <div class="appendvalue"> <input type="text" class=" form-control" disabled></div>
                                                            </td>
                                                            <td class="pt-0"><a class="btn btn-icon btn-sm btn-danger" onclick="DeleteRow(this)"><i class="fas fa-trash"></i></a></td>
                                                        </tr>
                                                        <tr>
                                                            <td class="pt-0" style="width: 50%">
                                                                <fieldset class="form-group">
                                                                    <select class="form-control input-sm fields select2" name="fields[]" onchange="getVal(this)" style="width: 100%;">
                                                                        <option value="Number">{{columns_name|dict_key:"Number"}}</option>
                                                                        <option value="Lifecycle_Phase">{{columns_name|dict_key:"Lifecycle_Phase"}}</option>
                                                                        <option value="Arista_Part_Number">{{columns_name|dict_key:"Arista_Part_Number"}}</option>
                                                                        <option value="Arista_PIC">{{columns_name|dict_key:"Arista_PIC"}}</option>
                                                                        <option value="Qualification_Status">{{columns_name|dict_key:"Qualification_Status"}}</option>
                                                                        <option value="Blended_AVG_PO_Receipt_Price">{{columns_name|dict_key:"Blended_AVG_PO_Receipt_Price"}}</option>
                                                                        <option value="cm_Part_Number">{{columns_name|dict_key:"cm_Part_Number"}}</option>
                                                                        <option value="cm_Quantity_Buffer_On_Hand">{{columns_name|dict_key:"cm_Quantity_Buffer_On_Hand"}}</option>
                                                                        <option value="cm_Quantity_On_Hand_CS_Inv">{{columns_name|dict_key:"cm_Quantity_On_Hand_CS_Inv"}}</option>
        
                                                                        <option value="commodity">Commodity</option>	
                                                                        <option value="cm">Contract Manufacturer</option>
                                                                        <option value="Cust_consign">{{columns_name|dict_key:"Cust_consign"}}</option>
                                                                        <!--<option value="ARIS_CQ_SANM_FQ_sum_1_unit_price_USD_Current_std">{{columns_name|dict_key:"ARIS_CQ_SANM_FQ_sum_1_unit_price_USD_Current_std"}}</option> --> 
                                                                        <option value="sgd_jpe_cost">{{columns_name|dict_key:"sgd_jpe_cost"}}</option>
                                                                        <option value="CQ_ARIS_FQ_sum_1_SANM_Demand">{{columns_name|dict_key:"CQ_ARIS_FQ_sum_1_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD"}}</option>
                                                                        <option value="Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista">{{columns_name|dict_key:"Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista"}}</option>
                                                                        <option value="Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1">{{columns_name|dict_key:"Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1"}}</option>
                                                                        <option value="Item_Desc">{{columns_name|dict_key:"Item_Desc"}}</option>
                                                                        <option value="LT">{{columns_name|dict_key:"LT"}}</option>
        
                                                                        <option value="Mfr_Name">{{columns_name|dict_key:"Mfr_Name"}}</option>
                                                                        <option value="Mfr_Part_Lifecycle_Phase">{{columns_name|dict_key:"Mfr_Part_Lifecycle_Phase"}}</option>
                                                                        <option value="Mfr_Part_Number">{{columns_name|dict_key:"Mfr_Part_Number"}}</option>
                                                                        <option value="MOQ">{{columns_name|dict_key:"MOQ"}}</option>
        
                                                                        <option value="Open_PO_due_in_this_quarter">{{columns_name|dict_key:"Open_PO_due_in_this_quarter"}}</option>
                                                                        <option value="Open_PO_due_in_next_quarter">{{columns_name|dict_key:"Open_PO_due_in_next_quarter"}}</option>
                                                                        <option value="Ownership">{{columns_name|dict_key:"Ownership"}}</option>
        
                                                                        <option value="Parts_controlled_by">{{columns_name|dict_key:"Parts_controlled_by"}}</option>
                                                                        <option value="Original_PO_Delivery_sent_by_Mexico">{{columns_name|dict_key:"Original_PO_Delivery_sent_by_Mexico"}}</option>
        
                                                                        <option value="Quarter">{{columns_name|dict_key:"Quarter"}}</option>
                                                                        <option value="CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand">{{columns_name|dict_key:"CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_3_ARIS_FQ_SANM_Demand">{{columns_name|dict_key:"CQ_sum_3_ARIS_FQ_SANM_Demand"}}</option>
                                                                        <option value="CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand"}}</option>
                                                                        <option value="refreshed_comment">Refreshed Comment</option>
                                                                        <option value="refreshed_on">Refreshed on</option>
                                                                        <option value="Rev">{{columns_name|dict_key:"Rev"}}</option>
                                                                        <option value="rfq_sent_flag_supplier">RFQ Sent Status</option>
                                                                        <option value="Delivery_Based_Total_OH_sum_OPO_this_quarter">{{columns_name|dict_key:"Delivery_Based_Total_OH_sum_OPO_this_quarter"}}</option>
                                                                        <option value="PO_Based_Total_OH_sum_OPO">{{columns_name|dict_key:"PO_Based_Total_OH_sum_OPO"}}</option>
                                                    

                                                                    </select>
                                                                </fieldset>
                                                            </td>
                                                            <td class="pt-0" style="width: 100%">
                                                                <div class="appendvalue">
                                                                    <input type="text" class="form-control" disabled>
                                                                </div>
                                                            </td>
                                                            <td class="pt-0"><a class="btn btn-icon btn-sm btn-danger" onclick="DeleteRow(this)"><i class="fas fa-trash"></i></a></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    
                                     <div class="float-end">
                                            <button class="btn btn-sm btn-outline btn-outline-success float-right">Apply Filter</button>
                                        </div>
                                    </div>
                                    <button type="button" id='Advance_filter_reset_button' hidden class="btn btn-info btn-sm ml-2"><i class="fa fa-refresh"></i> Advance filter reset</button>
                                </form>
                            </div>
                
                         </div>
                        </div>
                    </div>
                </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>




    </div>


<div class="card" id="main">
    <div class="card-header p-5">
        <h4>Portfolio</h4>
    </div>
    <div class="card-body p-5">
        <div class="table-responsive">
            <input type="hidden" id='download_flag' value=false>
            <input type="hidden" id='filter_flag' value='no_filter'>
            <input type="hidden" id='advance_flag' value='no_filter'>
            <input type="hidden" id='check_box_all_flag' value='no_filter'>
            <input type="hidden" id='table_filter_tab' value='all'>
            <input type="hidden" id='table_regional_filter_tab' value='Global'>
            <input type="hidden" id='to_rfx' value='supplier'>
            <span id="table_regional_filter_tab_parent" class="btn-group btn-group-xs float-right mr-1"></span>
            <table class="table table-bordered table-responsive" id="Portfolio_table">
                <thead class="bg-light-info text-center text-dark font-s">
                    <tr>
                        <th class="bg-light-info" id='add_checkbox'><input class="form-check-input" type="checkbox" onclick="select_all(this)" id="select_all_checkbox"></th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"cm"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Number"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"cm_Part_Number"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Arista_Part_Number"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Item_Desc"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Ownership"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Arista_PIC"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"commodity"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Lifecycle_Phase"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Rev"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Mfr_Name"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Mfr_Part_Lifecycle_Phase"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Mfr_Part_Number"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Qualification_Status"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Cust_consign"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Original_PO_Delivery_sent_by_Mexico"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"cm_Quantity_Buffer_On_Hand"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"cm_Quantity_On_Hand_CS_Inv"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"LT"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"MOQ"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Quarter"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Open_PO_due_in_this_quarter"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Open_PO_due_in_next_quarter"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Delivery_Based_Total_OH_sum_OPO_this_quarter"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"PO_Based_Total_OH_sum_OPO"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"CQ_ARIS_FQ_sum_1_SANM_Demand"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"CQ_sum_3_ARIS_FQ_SANM_Demand"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"sgd_jpe_cost"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD"}} ($)</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Blended_AVG_PO_Receipt_Price"}} ($)</th>
                            <th class="px-5 text-nowrap bg-light-info">Arista PIC Comment</th>
                            <th class="px-5 text-nowrap bg-light-info">{{columns_name|dict_key:"Parts_controlled_by"}}</th>
                            <th class="px-5 text-nowrap bg-light-info">BP Comment</th>
                            <th class="px-5 text-nowrap bg-light-info">refreshed comment</th>
                            <th class="px-5 text-nowrap bg-light-info">refreshed On</th>
                            <th class="px-5 text-nowrap bg-light-info">RFQ Sent Status</th>
                            <th class="px-5 text-nowrap bg-light-info">Delete</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- #####send RFX modal intial#### -->


<div id='blockmessage' class='p-5' style="display: none;" >
    <span class='ft-loader icon-spin font-large-2 text-center col-12'></span>
    <div class="semibold text-center">The portfolio is loading. <br>We will notify you when it is ready,Please Refresh the page after page is ready.</div>
    </div>
<style>
    .highlight{
        background-color: #f0f5fc;
    }

.content .content-wrapper {
     padding: 0.0rem !important ; 
}
</style>



<div id="kt_drawer_example_dismiss" class="bg-white drawer drawer-end " data-kt-drawer="true" data-kt-drawer-activate="true" data-kt-drawer-toggle="#portfolio_drawer" data-kt-drawer-close="#portfolio_drawer_closer" data-kt-drawer-overlay="true" data-kt-drawer-width="{default:'300px', 'md': '600px'}" style="width: 600px !important;">
    <div class="card rounded-0 w-100">
        <div class="card-header pe-5">
            <div class="card-title">
                <div class="d-flex justify-content-center flex-column me-3">
                    <a href="#" class="fs-4 fw-bold text-gray-900 text-hover-primary me-1 lh-1">Load Kickstart File</a>
                </div>
            </div>

            <div class="card-toolbar">
                <div class="btn btn-sm btn-icon btn-active-light-primary" id="portfolio_drawer_closer">
                    <span class="svg-icon svg-icon-2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor"></rect>
                    <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor"></rect>
                    </svg>
                    </span>
                </div>
            </div>
        </div>

        <div id="upload_placeholder" class="card-body hover-scroll-overlay-y">
            {% for cm in cms %}
            {% if request.user|has_group:"BP Team" or request.user.is_superuser %}
            {% get_portfolio_files cm as files %}
            <div class="card px-0">
                <h5 class="card-header py-1 px-0 bg-grey bg-lighten-4">{{ cm }} Portfolio Files <a class="info font-small-3 text-bold-600 float-right" href="{%url 'download_portfolio_kickstart' cm %}"> <u>Download Kickstart Template</u></a></h5> 
                <div class="card-body px-0 pt-0 font-small-3">
                    <form action="{%url 'portfolio_file_operations' 'form'%}" method="POST" class="upload_form">
                            {%csrf_token%}
                            <input type="hidden" name="cm" value="{{ cm }}">
                        <div class="row">
                            <div class="col-12">
                                <p>Select file to replace or select 'Add file' to add new file</p>
                                <p>Note: Make sure you upload XLSX file format</p>
                                <fieldset class="form-group position-relative">
                                    <select class="form-control form-control-sm" name='file_To_Replace' required>
                                        <option >Select file </option>
                                        <option selected value="add">+ ADD File</option>
                                        {%for x in files%}
                                        <option value="{{x.0}}">{{x.0}}</option>
                                        {%endfor%}
                                    </select>
                                </fieldset>
                            </div>
                            <div class="col-12">
                                <p>Choose File</p>
                                <input type="file" name="files" required>
                                <button type="submit" class="btn btn-outline btn-outline-success btn-sm square mt-1 float-right">Upload</button>
                            </div>
                        </div>
                    </form>
                        <div class="row" style="max-height:200px;overflow-y: auto;">
                            {%for x in files%}
                            <div class="col-9 mb-1">
                                {{x.0}},size:{{x.1}}Kb
                            </div>
                            
                            <div class="col-3 mb-1">
                                <a class="btn btn-icon btn-outline btn-outline-success" target="_blank" href="{%url 'portfolio_file_operations' 'download'%}?name={{ cm }}/{{x.0}}"><i class="fas fa-download"></i></a>
                                {%if request.user.is_superuser or request.user|has_group:"BP Team" %}<button class="btn btn-icon btn-outline btn-outline-danger delete" CM_loc='{{ cm }}' file="{{x.0}}"><i class="fas fa-trash"></i></button>{%endif%}
                            </div>
                            {%endfor%}
                            
                        </div>
                        <hr>
                        <div class="row">
                        <div class="col-12">
                            <small class="red"> <p >* For processing we consider only the top most file, So make sure the files is on top. </p></small>
                                        
                            <button class="btn btn-sm btn-outline btn-outline-info mx-1 render_button" CM_loc='{{ cm }}' >Load Portfolio {{ cm }}</button>
                            <button class="btn btn-sm btn-outline btn-outline-danger mx-1" onclick="load_upload()" >Reset</button>
                        
                        </div>
                    </div>
                    </div>
            </div>
            {%endif%}
            {% endfor %}
        </div>
        <!--end::Card body-->

        <!--begin::Card footer-->
        <div class="card-footer">
            <!--begin::Dismiss button-->
            <button class="btn btn-light-danger" data-kt-drawer-dismiss="true">Close Drawer</button>
            <!--end::Dismiss button-->
        </div>
        <!--end::Card footer-->
    </div>
    <!--end::Card-->
</div>
{% endblock %}
{% block scripts %}
<script src="{% static 'plugins/custom/formrepeater/formrepeater.bundle.js' %}"></script>
<script>
    $("#newrow").click(function() {
        var n = $('#advance_filter_tr').html();
        $('#advance_filter_table').append('<tr class="search_select">' + n + '</tr>');
        $('.search_select').find('select').select2();
    });
 
    function DeleteRow(r) {
        var i = r.parentNode.parentNode.rowIndex;
 
        document.getElementById("advance_filter_table").deleteRow(i);
    }
 
    $("#advance_filter_portfolio_form").submit(function(e) {
        e.preventDefault();
        var formData = new FormData(this);
        $.ajax({
            url: "{%url 'advance_filter' 'GSM Team' 'filter_form' 'all_data' %}",
            type: 'POST',
            data: formData,
            success: function(data) {
                $("#advance_flag").val('true');
                $('#Portfolio_table').DataTable().draw(false);
                $("#Advance_filter_div").hide();
                $("#Advance_filter_reset_button").attr('hidden', false);
            },
            cache: false,
            contentType: false,
            processData: false
        });
 
 
    });
 
    function getVal(r) {
        var field = $(r).closest('td').find('select').val();
        $(r).closest('td').next('td').find('.appendvalue').html('<select class="form-control attrib" name="' + field + '_value[]" multiple style="width: 100%" data-placehlder="Select Values"><option disabled value="">Select Value</option></select>');
        $.ajax({
            url: '/portfolio/portfolio/filter/advancefilter/GSM Team/get_value/' + field,
            dataType: 'json',
            type: 'get',
            contentType: 'application/json',
            success: function(data) {
                console.log(data)
                $.each(data, function(index, value) {
                    $(r).closest('td').next('td').find('select')
                        .append('<option value="' + value + '">' + value + '</option>')
                });
                $(r).closest('td').next('td').find('select').select2();
            },
            error: function(jqXhr, textStatus, errorThrown) {
                console.log(errorThrown);
            }
        });
    }
 
    function checkbox(id) {
 
        if (id != 0) {
            var checkbox_value = $(id).is(':checked')
            var data = {
                id: id.value,
                State: checkbox_value,
                option: 'check_box'
            }
        } else {
            var data = {
                id: 00,
                State: 'status',
                option: 'check_box'
            }
 
        }
 
        console.log(data)
        $.ajax({
            type: "GET",
            url: "{%url 'portfolio' 'extras'%}",
            data: data,
            success: function(data, status, xhr) {
                if (data.status !== 200) {
                    alert('Session Timeout:Re-Login In')
                    location.reload()
                }
                $("#select_count").html('<span class="text-bold-700 font-medium-1">Selected Rows: ' + (data.selected ==0 ? 'All':data.selected) + '</span>');
 
 
            },
 
            error: function(data) {
                swal('Session Timeout OR No Internet Connection,\n please Reload the page to fix')
            }
        })
        $('#Selected').attr('disabled', false)
        console.log(checkbox_value)
            //Do stuff
    }
    $(document).on("keyup", '.arista_pic_comment_text_box', function(event) {
        var timeout = null
        var text = this.value
        var id = this.getAttribute('portfolio_id')
        clearTimeout(timeout)
        timeout = setTimeout(function() {
            // Do AJAX shit here
            $.ajax({
            type: "GET",
            url: "{%url 'portfolio' 'extras'%}",
            data: {option:'comment',id:id,value:text},
            success: function(data, status, xhr) {
                if (data.status !== 200) {
                    alert('Session Timeout:Re-Login In')
                    location.reload()
                }
                $('#Portfolio_table').DataTable().draw(false);
 
 
            },
 
            error: function(data) {
                swal('Session Timeout OR No Internet Connection,\n please Reload the page to fix')
            }
        })
            $(this).blur()
        }, 2000)
 });
    $(document).on("keyup change", '.portfolio_field_editable', function(event) {
            var timeout = null
            var sett = null
            var text = this.value
            var id = this.getAttribute('portfolio_id')
            var field = this.getAttribute('field')
            clearTimeout(timeout)
            timeout = setTimeout(function() {
 
                $('#status').html('Saving...')
                $('#status').fadeIn(1000);
 
 
                $.ajax({
                type: "GET",
                url: "{%url 'portfolio' 'extras'%}",
                data: {option:'portfolio_field_editable',field:field,id:id,value:text},
                success: function(data, status, xhr) {
                    if (data.status !== 200) {
                        alert('Session Timeout:Re-Login In')
                        location.reload()
                    }
                    $('#status').html('Saved')
 
                    $('#Portfolio_table').DataTable().draw(false);
                    $('#status').show( "slow" )
                    clearTimeout(sett)
                    sett=setTimeout(function(){
                        $('#status').fadeOut(1000);
 
 
 
                        }, 3000)
 
 
 
                },
 
                error: function(data) {
                    swal('Session Timeout OR No Internet Connection,\n please Reload the page to fix')
                }
            })
                $(this).blur()
            }, 2000)
    });
    $("#upload_comments").submit(function(e) {
            e.preventDefault();
 
            var form = $(this);
            var url = form.attr('action');
            var formData = new FormData(this);
            console.log(formData)
            $.ajax({
                type: "POST",
                url: url,
                data: formData, // serializes the form's elements.
                success: function(data) {
                $.unblockUI();
                $("#upload_comments").trigger("reset");
 
                console.log(data)
                if (data.status == 422) {
                    $("#message_title").html(data.message);
                    $("#message_div").html(data.error_table);
                    $("#dialog_message").modal('show');
                    $('.compact').DataTable();
                }
                else if (data.status==415){
                    swal(`Invalid File format,Download and edit the excel file which is provide`, {
                        icon: "error",
                        timer: 2500
                    });
                }
                else if (data.status==200) {
                    swal(data.message, {
                        icon: "success",
                        timer: 2500
                    });
                    table.draw();
                }
                else{
                    swal(`Something went wrong,Refresh the page`, {
                        icon: "error",
                        timer: 2500
                    });
                }
 
            },
            error: function(exception) {
                $.unblockUI();
                swal("Upload a correct format excel file which had been downloaded from Tool", {
                    icon: "error",
                    button: true
                });
            },
                cache: false,
                contentType: false,
                processData: false
            });
            //after inserting
 
        });
    $(document).on("change", '.pic_field_editable', function(event) {
        swal({
                title: "Are you sure?",
                text: "If PIC name is changed from one team to another team then the RFQ created will be deleted automatically.",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((willDelete) => {
                if (willDelete) {
                    var timeout = null
                var sett = null
                var text = this.value
                var id = this.getAttribute('portfolio_id')
                var field = this.getAttribute('field')
                clearTimeout(timeout)
                timeout = setTimeout(function() {
                    $('#status').html('Saving...')
                    $('#status').fadeIn(1000);
 
 
                $.ajax({
                type: "GET",
                url: "{%url 'portfolio' 'extras'%}",
                data: {option:'portfolio_field_editable',field:field,id:id,value:text},
                success: function(data, status, xhr) {
                    if (data.status !== 200) {
                        alert('Session Timeout:Re-Login In')
                        location.reload()
                    }
                    $('#status').html('Saved')
 
                    $('#Portfolio_table').DataTable().draw(false);
                    $('#status').show( "slow" )
                    clearTimeout(sett)
                    sett=setTimeout(function(){
                        $('#status').fadeOut(1000);
 
                        }, 3000)
 
 
 
                },
 
                error: function(data) {
                    swal('Session Timeout OR No Internet Connection,\n please Reload the page to fix')
                }
            })
            }, 2000)
 
                } else {
                    swal("cancelled", {
                        timer: 1000
                    });
                }
            });
            });
 
    function select_all(data) {
        console.log($(data).is(':checked'))
        if ($(data).is(':checked')) {
            $("#check_box_all_flag").val('true')
            $('#Portfolio_table').DataTable().draw(false);
 
 
        } else {
            $("#check_box_all_flag").val('false')
 
            $('#Portfolio_table').DataTable().draw(false);
 
 
 
        }
 
    }
 </script>
 <script>
    function load_upload(){
        $.get('{%url "portfolio_file_operations" "load"%}',(data)=>{
                $('#upload_placeholder').html(data)
            })
    }
   $(document).ready(function() {
        $('.render_button').on('click',function(){
            CM_loc=$(this).attr('CM_loc')
            Swal.fire({
                title: `Are you sure ? `,
                text: `This process will take some time. Until then this page will be blocked. We will notify you when it is done`,
                icon: "warning",
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonText: 'Add Parts',
                denyButtonText: `Refresh Parts`,
                cancelButtonText: `Refresh cancel`,
                }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    $.get("{%url 'render_portfolio'%}",{CM_loc:CM_loc},function(data, status) {
                        if (data.status=='success'){
                            Swal.fire(data.message, {
                                icon: "success",
                                timer: 2500
                            });
                            check_re_render()
                             window.location.reload();
                        }
                        else if (data.status=='error'){
                            Swal.fire(data.message, {
                            icon: "error",
                            buttons: true
                        
                            });
                            check_re_render()
                        }
                        window.location.reload();
                    });
                } else if (result.isDenied) {
                    $.get("",{CM_loc:CM_loc}, function(data, status) {
                        if (data.status=='success'){
                            Swal.fire(data.message, {
                            icon: "success",
                            timer: 2500
                        });
                        check_re_render()
 
                        }
                        else if (data.status=='error'){
                            Swal.fire(data.message, {
                            icon: "error",
                            buttons: true
                        
                    });
                    check_re_render()
                    window.location.reload();
                }
                    });
                }
                else{
                    Swal.fire("Cancelled", {
                        icon: "error",
                        timer: 1000
                    });
                }
            })
 
        });
        $('.delete').on('click',function(){
            var file_name=$(this).attr('file')
            var cm=$(this).attr('CM_loc')
 
            Swal.fire({
                title: `Are you sure ?`,
                text: `Once deleted, you will not be able to recover it the file ${file_name}`,
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((result) => {
                if (result.isConfirmed) {
                    $.get("", {
                        file_name: file_name,cm:cm
                    }, function(data) {
                        if (data.status=='success'){
                            Swal.fire("File has been Removed from the system!", {
                                icon: "success",
                                timer: 2500
                            });
                        load_upload()
                        }
                        else{
                            Swal.fire("Error something wrong, reload may fix", {
                                icon: "error",
                                buttons: true
                            });
                        }
                    });
                    
                } else {
                    Swal.fire("Cancelled", {
                        icon: "error",
                        timer: 1000
                    });
                }
            });
        })
    $(".upload_form").submit(function(e) {
    e.preventDefault();
    var form = $(this);
    var url = form.attr('action');
    var formData = new FormData(this);
    
        $.ajax({
            type: "POST",
            url: url,
            data: formData, // serializes the form's elements.
            success: function(data) {
                load_upload()
            },
            error: function(exception) {
 
                swal('Upload a valid excel!', {
                    icon: 'error',
                    button: True,
                })
            },
            cache: false,
            contentType: false,
            processData: false
        });
    });
 
 
    });
 </script>
<script>
   $(document).ready(function() {
       //     $('#Portfolio_table thead th').each( function () {
       //     var title = $('#Portfolio_table thead th').eq( $(this).index() ).text();
       //     $(this).html( title+'<br><input type="text" />' );
       // } );
       $('[data-toggle="tooltip"]').tooltip(); 
       

       $('#Portfolio_table').DataTable({
           language: {
               "emptyTable": "No data available in table",
               "info": "Showing _START_ to _END_ of _TOTAL_ entries",
               "infoEmpty": "Showing 0 to 0 of 0 entries",
               "infoFiltered": "(filtered from _MAX_ total entries)",
               "infoPostFix": "",
               "thousands": ",",
               "lengthMenu": "Show _MENU_ entries",
               "loadingRecords": "Loading...",
               "processing": "Fetching...",
               "search": "Search",
               "zeroRecords": "<p class='pl-5 font-medium-3 pull-left'>No matching records found</p>",
               "paginate": {
                   "first": "First",
                   "last": "Last",
                   "next": "Next",
                   "previous": "Previous"
               },
               "aria": {
                   "sortAscending": ": activate to sort column ascending",
                   "sortDescending": ": activate to sort column descending"
               }
           }, // global variable defined in html
           // order: [[18, "desc"]],
           lengthMenu: [
               [20, 50, 100, -1],
               [20, 50, 100, 'ALL']
           ],
           searching: true,
           processing: true,
           serverSide: 'true',
           // stateSave: true,
           // colReorder: {
           //     allowReorder: true
           // },
           "order": [[1, "desc"]],
           "columnDefs": [ {
               "targets"  : 'no-sort',
               "orderable": false,
           }],
           autoWidth: true,
           // colReorder: true,
           columns: [{
                   'searchable': false,
                   'orderable': false,
                   'className': 'dt-body-center ',
                   "data": "Checkbox",
                   'render': function(data, type, full, meta) {
                       console.log(data,'check box data')
                       if (data[5]===false){
                           return ''
                       }
                       if(data[4].all){
                           var render_data=`<span class='badge badge-success font-small-1'>Quote Raised for all</span>`;

                           }
                       else if (data[0] === null) {
                               var render_data = data[0]
                               return ''
                       }
                       else if(data[2]){
                           var data=`<span class='badge btn badge-success font-small-1' onclick="quote_message('Quote has been raised in ${data[3]}, please delete it from Quote analysis to create from here');">Quote Raised as ${data[3]}</span>`
                           return data
                       }
                       else if (data[4].sent_all==false) {
                           var render_data = `<input type="checkbox" class="selection" onclick="checkbox(this)" value='${data[1]}'  name="select_checkbox" ${data[0]} id="${data[1]}_checkbox" >`;
                       }
                       
                       
                           
                       else if(data[4].partial){
                           console.log('partial')
                           let q=data[4]
                           if (q.partial==true) {
                               check=`<input type="checkbox" class="selection" onclick="checkbox(this)" value='${data[1]}'  name="select_checkbox" ${data[0]} id="${data[1]}_checkbox" >`
                           }
                           else{
                               check=''
                           }
                           var render_data=`
                           ${check}
                           <span class='badge row badge-primary ml-1 text-left font-small-1 bg-lighten-4'>
                               Q+1 Supp.:${q.supp_q1}/${q.supp}  Dist.:${q.dis_q1}/${q.dis}<br>
                               Q &nbsp;&nbsp;&nbsp;&nbsp;Supp.:${q.supp_q}/${q.supp} Dist.:${q.dis_q}/${q.dis}<br>
                               
                               </span>
                           `;

                           }
                       else if (data[0] != null) {
                           
                           var render_data = `<input type="checkbox" class="selection" onclick="checkbox(this)" value='${data[1]}'  name="select_checkbox" ${data[0]} id="${data[1]}_checkbox" >`;
                       }
                       else {
                           var render_data = null
                       }
                       return render_data
                   }
               }, {
                   "data": "cm"
               },{
                   "data": "Number",
                   "render": function(data, type, row, meta) {
                       if (type === 'display') {
                           data = '<a class="text-bold-600 info" href="/History/Historydata/' + data + '" target="_blank"><u>' + data + '</u></a>';
                       }
                       return data;
                   }
               }, {
                   'data':null,'className': 'dt-body-center  py-0',render:function (data){

                   // {% if request.user|has_group:"BP JPE Manager,BP SGD Manager,BP FGN Manager,BP HBG Manager,BP JSJ Manager,BP JMX Manager" or request.user.is_superuser %}
                   if (data.cm!='Global'){
                   value=`<input type='text' portfolio_id='${data.id}' field='cm_Part_Number' class='portfolio_field_editable text-muted m-0 bg-transparent border-transparent ' value='${data.cm_Part_Number==null ?'':data.cm_Part_Number}'>`
                   }
                   else{
                       value=data.cm_Part_Number
                   }

                   // {%else%}
                   value=data.cm_Part_Number
                   // {%endif%}
                   return value
                       }
               }, {
                   "data": "Arista_Part_Number"
               }, {
                   "data": "Item_Desc"
               }, {
                   'data':null,'className': 'dt-body-center  py-0',render:function (data){
                   // {% if request.user|has_group:"BP JPE Manager,BP SGD Manager,BP FGN Manager,BP HBG Manager,BP JSJ Manager,BP JMX Manager" or request.user.is_superuser %}
                   value=`<input type='text' portfolio_id='${data.id}' field='Ownership' class='portfolio_field_editable text-muted m-0 bg-transparent border-transparent ' value='${data.Ownership==null ?'':data.Ownership}'>`
                   if (data.cm=='SGD'){
                       cmname="Sanmina"
                   }else if(data.cm=='JPE'){
                       cmname="Jabil"
                   }
                   else if(data.cm=='FGN'){
                       cmname="Flex"
                   }
                   else if(data.cm=='HBG'){
                       cmname="Foxconn"
                   }else if(data.cm=='JSJ'){
                       cmname="Jabil San Jose"
                   }else if(data.cm=='JMX'){
                       cmname="Jabil Mexico"
                   }else{
                       cmname="None"
                   }
                   if (cmname != 'None'){
                       value=`
                   <select class='input select-xs portfolio_field_editable text-muted m-0 bg-transparent border-transparent' portfolio_id='${data.id}' field='Ownership' name='name'>
                   <option selected value="${data.Ownership}">${data.Ownership}</option>
                   <option  value="Arista">Arista</option>
                   <option  value="${cmname}">${cmname}</option>
                   </select>`
                   }
                   else{
                       value=data.Ownership
                   }
                   // {%else%}
                   value=data.Ownership
                   // {%endif%}
                   return value
                       }
               } ,
               {
                   'data':null,'className': 'dt-body-center  py-0',render:function (data){
                   // {% if request.user|has_group:"BP JPE Manager,BP SGD Manager,BP FGN Manager,BP HBG Manager,BP JSJ Manager,BP JMX Manager" or request.user.is_superuser %}
                   value=`<input type='text' portfolio_id='${data.id}' field='Arista_PIC' class='portfolio_field_editable text-muted m-0 bg-transparent border-transparent ' value='${data.Arista_PIC==null ?'':data.Arista_PIC}'>`
                   if (data.cm!='Global'){
                       value=`
                   <select class='input select-xs pic_field_editable text-muted m-0 bg-transparent border-transparent' portfolio_id='${data.id}' field='Arista_PIC' name='name'>
                   {%names_of_pic Team='GSM Team' as names %}
                   <option selected disabled value="${data.Arista_PIC}">${data.Arista_PIC}</option>
                   {%for name in names %}
                   <option value="{{name.1}}">{{name.0}}</option>
                   {%endfor%}
                   <option value="John Malian/Erlyn">John Malian/Erlyn</option>
                   <option value="Kathy Ch'ng/Erlyn">Kathy Ch'ng/Erlyn</option>
                   <option value="Kathy Ch'ng/Huan">Kathy Ch'ng/Huan</option>
                   <option value="Kathy Ch'ng/Rima">Kathy Ch'ng/Rima</option>
                   <option value="Kathy Ch'ng/Susan">Kathy Ch'ng/Susan</option>
                   <option value="Kathy Ch'ng/Yonn">Kathy Ch'ng/Yonn</option>
                   <option value="Kathy Ch'ng/Eduardo">Kathy Ch'ng/Eduardo</option>
                   <option value="Lai Chen Soong/John">Lai Chen Soong/John</option>
                   <option value="Lai Chen Soong/Susan">Lai Chen Soong/Susan</option>
                   <option value="Lai Chen Soong/Yonn">Lai Chen Soong/Yonn</option>
                   <option value="Lai Chen Soong/Erlyn">Lai Chen Soong/Erlyn</option>
                   <option value="Lai Chen Soong/Eduardo">Lai Chen Soong/Eduardo</option>
                   </select>
                   `
                   }
                   else{
                       value=data.Arista_PIC
                   }

                   // {%else%}
                   value=data.Arista_PIC
                   // {%endif%}
                   return value
                       }
               },{
                   "data": "commodity"
               }, {
                   "data": "Lifecycle_Phase"
               }, {
                   "data": "Rev"
               }, {
                   "data": "Mfr_Name"
               }, {
                   "data": "Mfr_Part_Lifecycle_Phase"
               }, {
                   "data": "Mfr_Part_Number"
               }, {
                   "data": "Qualification_Status"
               }, {
                   'data':null,'className': 'dt-body-center  py-0',render:function (data){
                   // {% if request.user|has_group:"BP JPE Manager,BP SGD Manager,BP FGN Manager,BP HBG Manager,BP JSJ Manager,BP JMX Manager" or request.user.is_superuser %}
                   if (data.cm!='Global'){
                   value=`
                   
                   <select class='input select-xs portfolio_field_editable text-muted m-0 bg-transparent border-transparent' portfolio_id='${data.id}' field='Cust_consign' name='Cust_consign' value='${data.Cust_consign==null ?'':data.Cust_consign}'>
                   <option selected disabled value="${data.Cust_consign}">${data.Cust_consign}</option>
                   <option value="Y">Y</option>
                   <option value="N">N</option>
                   `
                   }
                   else{
                       value=data.Cust_consign
                   }
                   // {%else%}
                   value=data.Cust_consign
                   // {%endif%}
                   return value
                       }
               }, {
                   'data':null,'className': 'dt-body-center  py-0',render:function (data){
                       if (data.cm!='Global'){
                   // {% if request.user|has_group:"BP JPE Manager,BP SGD Manager,BP FGN Manager,BP HBG Manager,BP JSJ Manager,BP JMX Manager" or request.user.is_superuser %}
                       value=`
                   <select class='input select-xs portfolio_field_editable text-muted m-0 bg-transparent border-transparent' portfolio_id='${data.id}' field='Original_PO_Delivery_sent_by_Mexico' name='Original_PO_Delivery_sent_by_Mexico' value='${data.Original_PO_Delivery_sent_by_Mexico==null ?'':data.Original_PO_Delivery_sent_by_Mexico}'>
                   <option selected disabled value="${data.Original_PO_Delivery_sent_by_Mexico==null ?'':data.Original_PO_Delivery_sent_by_Mexico}">${data.Original_PO_Delivery_sent_by_Mexico==null ?'':data.Original_PO_Delivery_sent_by_Mexico}</option>
                   <option value="PO">PO</option>
                   <option value="Delivery">Delivery</option>
                   `


                   // {%else%}
                   value=data.Original_PO_Delivery_sent_by_Mexico
                   // {%endif%}
                   }
                   else
                   {
                       value=data.Original_PO_Delivery_sent_by_Mexico
                   }
                   
                   return value
                       }
               }, {
                   "data": "cm_Quantity_Buffer_On_Hand"
               }, {
                   "data": "cm_Quantity_On_Hand_CS_Inv"
               }, {
                   "data": "LT"
               }, {
                   "data": "MOQ"
               }, {
                   "data": "Quarter"
               },{
                   "data": "Open_PO_due_in_this_quarter"
               }, {
                   "data": "Open_PO_due_in_next_quarter"
               }, {
                   "data": "Delivery_Based_Total_OH_sum_OPO_this_quarter"
               }, {
                   "data": "PO_Based_Total_OH_sum_OPO"
               }, {
                   "data": "CQ_ARIS_FQ_sum_1_SANM_Demand"
               }, {
                   "data": "CQ_sum_1_ARIS_FQ_sum_2_SANM_Demand"
               }, {
                   "data": "CQ_sum_2_ARIS_FQ_sum_3_SANM_Demand"
               }, {
                   "data": "CQ_sum_3_ARIS_FQ_SANM_Demand"
               }, {
                   "data": "Delta_OH_and_Open_PO_DD_CQ_sum_CQ_sum_1_Arista"
               },
               //  {
               //     "data": "ARIS_CQ_SANM_FQ_sum_1_unit_price_USD_Current_std"
               // },
               {
                   "data": "sgd_jpe_cost"
               }, {
                   "data": "CQ_sum_1_ARIS_FQ_sum_2_SANM_unit_price_USD"
               }, {
                   "data": "Delta_ARIS_CQ_sum_1_SANM_FQ_sum_2_vs_ARIS_CQ_SANM_FQ_sum_1"
               }, {
                   "data": "Blended_AVG_PO_Receipt_Price"
               },
               {'data':null,'className': 'dt-body-center  py-0',render:function (data){
                   if (data.Arista_PIC.includes('{{request.user.first_name}}')){

                       text= `<textarea rows="1" cols="30" portfolio_id='${data.id}' class='arista_pic_comment_text_box m-0 bg-transparent border-transparent blue' value='${data.Arista_pic_comment==null ?'':data.Arista_pic_comment}'>${data.Arista_pic_comment==null ?'':data.Arista_pic_comment}</textarea>`

                   }
                   else{
                       text=`<textarea rows="1" cols="30" portfolio_id='${data.id}'  disabled class='arista_pic_comment_text_box m-0 bg-transparent border-transparent blue' value='${data.Arista_pic_comment==null ?'':data.Arista_pic_comment}'>${data.Arista_pic_comment==null ?'':data.Arista_pic_comment}</textarea>`
                   }

                   return text
               }}, {
                   "data": "Parts_controlled_by"
               }, {
                   "data": "bp_comment"
               },
               {'data':'refreshed_comment'},
               {'data':'refreshed_on'},
               {'data':null,
               'className': 'dt-body-center text-center ',
               render:function (data){
                   if (data.rfq_sent_flag_supplier=='Quote Raised'){

                       return `<span class='badge badge-success'>${data.rfq_sent_flag_supplier}</span>`
                   }
                   else{
                       return `<span class='badge badge-danger'>${data.rfq_sent_flag_supplier}</span>`

                   }

               },},
               // {
               //     'data': "rfq_sent_flag_cm"
               // },{
               //     'data': "rfq_sent_flag_distributor"
               // },
               {
                   'data': null,
                   'searchable': false,

                   render:function (data){
                       if (data.cm=='Global'){
                           return `Delete From regional Tab`
                       }
                   return `
                   {% if request.user|has_group:"BP Manager" or request.user|has_group:"Super User" or request.user|has_group:"Iness" %}
                   <span class='btn btn-sm btn-outline-success font-small-1x' onclick='agile_refresh(${data.id})'><i class=' fa fa-refresh'></i> Refresh APN</span>
                   {%endif%}
                   <span class='btn btn-sm btn-outline-danger' onclick='delete_portfolio(${data.id},"${data.Number}","${data.Mfr_Part_Number}")'><i class=' fa fa-trash-o'></i></span>
                   `
               }

               }

           ],
           buttons: [{
               extend: 'colvis',
               className: "btn btn-outline-secondary btn btn-secondary dropdown-toggle btn-sm",

           }, {
               extend: 'excelHtml5',
               className: "btn btn-outline-secondary btn-sm",

               exportOptions: {
                   columns: ':visible',
               }
           }, {
               extend: 'copy',
               className: "btn btn-outline-secondary btn-sm",

           }, ],

           ajax: {
               url: '{% url "Portfolio_data" %}',
               "type": "GET",

               "data": function(d) {
                   return $.extend({}, d, {
                       "filter": $("#filter_flag").val(),
                       "advance_filter": $("#advance_flag").val(),
                       "team": 'GSM Team',
                       'download': $("#download_flag").val(),
                       'check_box_all_flag': $("#check_box_all_flag").val(),
                       'table_filter_tab': $('#table_filter_tab').val(),
                       "table_regional_filter_tab":$('#table_regional_filter_tab').val(),
                       "to_rfx":$('#to_rfx').val()
                   });
               }

           },
           fixedColumns: {
               leftColumns: 3,
               rightColumns: 0,
           },
           scrollY: '50vh',
           scrollX: '70vh',
           "paging": "True",
           //  dom: '<"top"i>rt<"bottom"flp><"clear">'
           // responsive: true
           "drawCallback": function(settings) {

               checkbox(0)


               if ($("#check_box_all_flag").val() === 'true' || $("#check_box_all_flag").val() === 'false') {
                   $("#check_box_all_flag").val('no_filter')
                   $('#Portfolio_table').DataTable().draw()
               }
               // stop_loader();


           }

       });
       var table = $('#Portfolio_table').DataTable()

       $('#Portfolio_table tbody').on( 'click', 'tr', function () {
           if ( $(this).hasClass('highlight') ) {
               $(this).removeClass('highlight');
           }
           else {
               table.$('tr.highlight').removeClass('highlight');
               $(this).addClass('highlight');
           }
       } );
       $('.toggle-vis').on('change', function(e) {
           e.preventDefault();
           // console.log($(this).attr('data-column'))
           // Get the column API object

           for (i = 1; i < 100; i++) {
               // console.log(i)
               var title = table.column(i).data();
               // console.log(table.columns(i).dataSrc()[0],'###',($(this).attr('data-column')))
               if (table.columns(i).dataSrc()[0] == $(this).attr('data-column')) {
                   var column = table.column(i);
                   break;
               }
           }
           // console.log($(this).attr('data-column'))
           // Toggle the visibility
           column.visible(!column.visible());
       });

       // $('#Portfolio_table').DataTable().columns().every(function() {
       //     var column = this;
       //     console.log(column)

       //     $('select', this.footer()).on('change', function() {
       //         column.search(this.value).draw(false);

       //     });
       //     $('input', this.footer()).on('keyup change', function() {
       //         column.search(this.value).draw(false);

       //     });
       // });
       $("#Portfolio_master_search").on('change', function() {
           $('#Portfolio_table').DataTable().search(this.value).draw();

       });
       $("#Portfolio_master_search_button").on('click', function() {
           $('#Portfolio_table').DataTable().search($("#Portfolio_master_search").val()).draw();

       });
       $("#filterExcel").submit(function(e) {
           e.preventDefault(); // avoid to execute the actual submit of the form.
           $.blockUI({
               message: '<div class="semibold"><span class="ft-refresh-cw icon-spin text-left"></span>&nbsp; Filtering the Data ...</div>',

               overlayCSS: {
                   backgroundColor: '#FFF',
                   opacity: 0.8,
                   cursor: 'wait'
               },
               css: {
                   border: 0,
                   padding: 0,
               }
           });
           var form = $(this);
           var url = form.attr('action');
           var formData = new FormData(this);
           console.log(formData)
           $.ajax({
               type: "POST",
               url: url,
               data: formData, // serializes the form's elements.
               success: function(data) {
                   $("#filter_flag").val('excel')
                   $("#filterExcel").trigger("reset");
                   $('#reset_menu').attr('hidden', false)
                   $("#filter_mega_menu").click();
                   $("#filterExcel").hide();
                   table.draw(false);

                   $.unblockUI();
                   swal('Filtered with excel', {
                       icon: 'success',
                       button: false,
                       timer: 1000
                   })
               },
               error: function(exception) {
                   $.unblockUI();
                   swal('Upload a valid excel which has been downloaded !', {
                       icon: 'error',
                       button: true,
                   })
                   
               },
               cache: false,
               contentType: false,
               processData: false
           });
           //after inserting

       });
       $('#reset_menu').on('click', function() {
           $('#reset_menu').attr('hidden', 'true');
           $("#filterExcel").show();
           $("#filter_flag").val('no_filter')
           table.draw(false);
           swal('Excel filter reverted', {
               icon: 'success',
               button: false,
               timer: 1000
           })

           $.unblockUI();
       })
       $("#Advance_filter_reset_button").on('click', function() {
           $('#advance_flag').val('no_filter');
           $('#Advance_filter_div').show();
           $('#Advance_filter_reset_button').attr('hidden', true);
           $('#Portfolio_table').DataTable().draw(false);

       });
       $('#select_all_checkbox').on('click change', function() {
           console.log(this.is(':checked'))

       });
       $('.table_filter_tab').on('click', function() {
           // if (this.value=='all'){
           //     $('#tooltip_button_send').attr('tooltip-data','sasas');
               
           // }
           // else{
           //     $('#send_rfq_button_main').removeClass('active');
           // }
           $('#table_filter_tab').val(this.value)
           $('#Portfolio_table').DataTable().draw(false);
           $('#table_filter_tab_parent').children().removeClass('active')
           $(this).addClass('active')
       })
       $('.table_regional_filter_tab').on('click', function() {
           
           $('#table_regional_filter_tab').val(this.value)
           $('#Portfolio_table').DataTable().draw(false);
           $('#table_regional_filter_tab_parent').children().removeClass('active')
           $(this).addClass('active')
       })


   });
</script>
<script>
   function quote_message(message){
       swal.fire(message)
   }
   
   function select_all(data) {
       console.log($(data).is(':checked'))
       if ($(data).is(':checked')) {
           $("#check_box_all_flag").val('true')
           $('#Portfolio_table').DataTable().draw(false);


       } else {
           $("#check_box_all_flag").val('false')
           $('#Portfolio_table').DataTable().draw(false);



       }

   }
   function load_upload(){
       $.get('{%url "portfolio_file_operations" "load"%}',(data)=>{
               $('#upload_placeholder').html(data)
           })

   }
   function check_re_render(){

   $.get('{%url "portfolio_file_operations" "check_render"%}',(data)=>{
       //console.log(data)
       if (data.status==true){

           $('#main').hide()
           $('#blockmessage').show()
           $('#name').html(data.name)
   }
   else{
       $('#main').show();
       $('#blockmessage').hide();

   }

       })
}
   $(document).ready(function() {
       
       check_re_render()
       setInterval(check_re_render, 10000);


       $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
       $($.fn.dataTable.tables(true)).DataTable()
          .columns.adjust()
          .responsive.recalc();
       });

       
      
   });
   

</script>
<script>
function delete_portfolio(get_value) {
   var id= get_value.getAttribute('line_id')
   var value = get_value.getAttribute('value')

       Swal.fire({
               title: `Are you sure ? `,
               text: `Delete`,
               icon: "error",
               showCancelButton: true,
               confirmButtonText: 'Delete',
               cancelButtonText: `Cancel`,
               })
   .then((result) => {
       if (result.isConfirmed) {
           $.get("", {
               id: id,value : value
           }, function(data) {
               if (data.status==200){
               $('#Portfolio_table').DataTable().ajax.reload(null, false);
               Swal.fire({
                   icon: "success",
                   title: 'Success!',
                   text: "Deleted Successfully!",
               });
               location.reload()
           }
           else{
                   Swal.fire({
                       icon: 'error',
                       title: 'Failed!',
                       text: 'Failed!',
               })
               }
           });
       } 
       else{
           Swal.fire( {
               icon: "error",
               text:"Cancelled",
           });
       }
   });


}
</script>
{% endblock %}